<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<title>Mikan Project RSS 缓存服务器后台</title>
	<!-- Import style -->
	<link rel="stylesheet" href="./css/lib/element.css"/>
	<!-- Import Vue 3 -->
	<script src="./js/lib/vue.global.js"></script>
	<!-- Import component library -->
	<script src="./js/lib/element.full.js"></script>
</head>
<body>
<div id="app">
	<span>{{ message }}</span>
	<label>
		<input
			:value="sitePrefixInput"
			@input="setSitePrefix"
			placeholder="site prefix"
		/>
	</label>
	<label>
		<input
			:value="siteMatcherInput"
			@input="setSiteMatcher"
			placeholder="site contains"
		/>
	</label>
	<hr/>
	<el-table :data="followList" style="width: 100%">
		<el-table-column prop="id" label="ID" width="180"></el-table-column>
		<el-table-column prop="rssSite" label="网站源" width="180"></el-table-column>
		<el-table-column prop="regexFilter" label="Regex"></el-table-column>
		<el-table-column prop="comment" label="注释"></el-table-column>
		<el-table-column prop="enabled" label="状态"></el-table-column>
		<el-table-column prop="followAddedTime" label="添加时间"></el-table-column>
		<el-table-column prop="followModifiedTime" label="变动时间"></el-table-column>
		<el-table-column prop="lastUpdateSucceedTime" label="最近成功访问时间"></el-table-column>
		<el-table-column prop="updateContinueFailCounter" label="连续访问失败计数"></el-table-column>
	</el-table>
</div>
</body>
<script type="module">
	import {getFull} from './js/request.js'
	import {verifyFollowList} from "./js/indexUtils.js";

	const app = Vue.createApp({
		el: "#app",
		data() {
			return {
				message: 'Hello Vue!',
				followList: [],
				sitePrefixInput: '',
				siteMatcherInput: ''
			}
		},
		methods: {
			loadFollowList() {
				getFull(
					'/rss/follow/list',
					{
						fromId: 0,
						pageSize: 100,
						sitePrefix: this.sitePrefixInput,
						siteMatcher: this.siteMatcherInput
					},
					(code, msg, body) => {
						console.log(body)
						this.followList = body;
					},
					(error) => {
						alert('网络异常！');
						console.log(error);
					},
					(error) => {
						alert('处理异常！');
						console.log(error);
					},
					(body) => {
						verifyFollowList(body);
					},
					(error, body) => {
						alert('非法数据！');
						console.log(error);
						console.log(body)
					}
				);
			},
			setSitePrefix(event) {
				this.sitePrefixInput = event.target.value;
				this.fromId = 0;
			},
			setSiteMatcher(event) {
				this.siteMatcherInput = event.target.value;
				this.fromId = 0;
			},
			formatDate(unixTimestamp) {
				console.log('unixTimestamp:' + unixTimestamp)
				if (unixTimestamp == null || unixTimestamp === 0) {
					return 'N/A';
				}
				const date = new Date(unixTimestamp * 1000);
				const y = date.getFullYear();
				let m = date.getMonth() + 1;
				m = m < 10 ? ('0' + m) : m;
				let d = date.getDate();
				d = d < 10 ? ('0' + d) : d;
				let h = date.getHours();
				h = h < 10 ? ('0' + h) : h;
				let minute = date.getMinutes();
				minute = minute < 10 ? ('0' + minute) : minute;
				let second = date.getSeconds();
				second = second < 10 ? ('0' + second) : second;
				return y + '-' + m + '-' + d + ' ' + h + ':' + minute + ':' + second;
			}
		},
		mounted() {
			this.loadFollowList()
		}
	});
	app.use(ElementPlus);
	app.mount('#app')
</script>


</html>